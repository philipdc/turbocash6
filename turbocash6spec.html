<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>TurboCASH 6 System Architecture Specification</title>
    <meta name="description" content="TurboCASH 6: AI-facing open source accounting package using JavaScript, interoperable with TurboCASH 5, featuring REST API, NoSQL/SQL, ETL, RAG, and OpenAI integration.">
    <meta name="keywords" content="TurboCASH 6, accounting software, open source, JavaScript, Delphi, AI, OpenAI, REST API, NoSQL, MongoDB, Firebird SQL, ETL, RAG system architecture, CRUD interoperability, Windows, Linux SPA">
    
    
    
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <style>
        body { font-family: system-ui, sans-serif; margin: 2rem; background: #fff; color: #222; }
        h1, h2, h3 { color: #1a4b7a; }
        pre, code { background: #978888; padding: 0.9em; border-radius: 6px; }
        .semantics-map { background: #e8f0fe; padding: 1em; border-radius: 6px; margin-bottom: 2em; }
    </style>
</head>
<body>
    <h1>TurboCASH 6 System Architecture Specification</h1>

    <img src="https://www.turbocash.net/a/pages/ai/images/turbocashaidinner2.jpg" alt="TurboCASH AI Dinner" style="max-width:100%;height:auto;">


    <section class="semantics-map">
        <h2>Semantic Map for AI/LLM Search Optimisation</h2>
        <ul>
            <li><strong>TurboCASH 6</strong>: AI-powered, open source accounting system</li>
            <li><strong>Technology Stack</strong>: JavaScript (frontend &amp; backend), REST API, HTML SPA</li>
            <li><strong>Database</strong>: Firebird SQL (primary), NoSQL (e.g., MongoDB) for AI workflows</li>
            <li><strong>AI Integration</strong>: OpenAI API, Retrieval-Augmented Generation (RAG), ETL</li>
            <li><strong>Interoperability</strong>: TurboCASH 5 compatibility via open API</li>
            <li><strong>Security</strong>: HTTPS, JWT authentication, user authorization</li>
            <li><strong>Deployment</strong>: Windows 10/11, Linux (optional)</li>
            <li><strong>Frontend</strong>: Responsive HTML/JavaScript SPA, CRUD operations</li>
            <li><strong>Data Flow</strong>: User → Frontend → Server API → Database/AI</li>
            <li><strong>Extensibility</strong>: Modular layers, interchangeable NoSQL backend</li>
        </ul>
    </section>

    <h2>1. Overview</h2>
    <ul>
        <li>TurboCASH Server operates on Windows 10 or 11 (Pro not required), Linux support desirable.</li>
        <li>Enables CRUD operations on TurboCASH Books.</li>
        <li>HTML/JavaScript frontend with OpenAI integration for AI-powered features.</li>
    </ul>

    <h2>2. Server Layer</h2>
    <ul>
        <li>RESTful API for CRUD operations.</li>
        <li>Middleware for validation, logging, error management.</li>
        <li>API endpoints secured with authentication (e.g., JWT).</li>
        <li>Supports concurrent client connections.</li>
        <li>API documentation for integration.</li>
    </ul>

    <h2>3. Database Layer</h2>
    <ul>
        <li>TurboCASH Books stored in Firebird SQL database.</li>
        <li>Direct connectivity for persistent storage and retrieval.</li>
        <li>Database access managed via secure connectors.</li>
    </ul>

    <h3>3.1. Extracted Data Structure for AI Workflows</h3>
    <ul>
        <li><strong>Purpose:</strong> Facilitate AI-powered features (e.g., RAG, natural language queries) by transforming data into a flexible, token-friendly format.</li>
        <li><strong>NoSQL Representation:</strong> After ETL, records are mapped to a document-oriented NoSQL structure (e.g., JSON objects), easily convertible to tokens for AI models.</li>
        <li><strong>Example Structure:</strong></li>
    </ul>
    <pre><code>{
    "book_id": "12345",
    "customer": {
        "name": "Acme Corp",
        "address": "123 Main St",
        "contacts": ["info@acme.com"]
    },
    "transactions": [
        {
            "date": "2024-06-01",
            "amount": 1000,
            "type": "invoice"
        }
    ],
    "metadata": {
        "last_modified": "2024-06-10T12:00:00Z"
    }
}
    </code></pre>
    <ul>
        <li><strong>Advantages:</strong>
            <ul>
                <li>Tokenization: JSON-like structures are natively supported by most AI tokenizers.</li>
                <li>Flexibility: Easily accommodates new fields or schema changes.</li>
                <li>Interoperability: Efficient for RAG and AI workflows.</li>
            </ul>
        </li>
        <li><strong>Conversion Process:</strong>
            <ul>
                <li>ETL layer extracts relational data.</li>
                <li>Transforms records into NoSQL (JSON) documents.</li>
                <li>Stores in a transient NoSQL store or passes directly to AI modules.</li>
            </ul>
        </li>
        <li><strong>Integration:</strong> Used by the RAG orchestration layer to provide relevant context to OpenAI-powered features.</li>
    </ul>

    <h2>4. ETL &amp; RAG Orchestration Layer</h2>
    <ul>
        <li>ETL service extracts, transforms, and loads data from Firebird SQL.</li>
        <li>Data cleansing, normalization, and enrichment for AI consumption.</li>
        <li>RAG orchestration uses ETL output to provide context for AI workflows.</li>
        <li>Integrates with model context protocol for Retrieval-Augmented Generation.</li>
    </ul>

    <h2>5. Frontend Layer</h2>
    <ul>
        <li>HTML/JavaScript SPA communicates with TurboCASH Server API.</li>
        <li>Provides CRUD interface for TurboCASH Books.</li>
        <li>Responsive design for desktop and mobile devices.</li>
    </ul>

    <h2>6. AI Integration Layer</h2>
    <ul>
        <li>OpenAI API integrated into frontend for natural language queries and data analysis.</li>
        <li>AI logic embedded in system for enhanced user interaction with accounting data.</li>
    </ul>

    <h2>7. Data Flow</h2>
    <ul>
        <li>User interacts with frontend.</li>
        <li>Frontend sends CRUD requests to TurboCASH Server API.</li>
        <li>AI features leverage OpenAI API for insights and automation.</li>
        <li>ETL/RAG layers ensure relevant, up-to-date data for AI.</li>
    </ul>

    <h2>8. Security &amp; Deployment</h2>
    <ul>
        <li>HTTPS for secure communication.</li>
        <li>User authentication and authorization.</li>
        <li>Deployable on standard Windows 10/11 hardware.</li>
    </ul>

    <h2>9. Integration Points</h2>
    <ul>
        <li>ETL interfaces with Firebird SQL database.</li>
        <li>RAG orchestration bridges ETL and OpenAI API.</li>
        <li>Frontend, server, and AI layers communicate via documented APIs.</li>
    </ul>

    <h2>System Architecture Diagram (Textual)</h2>
    <pre>
[User] &lt;--HTML/JS SPA--&gt; [TurboCASH Server API] &lt;---&gt; [TurboCASH Database]
                            |
                            v
                [ETL &amp; RAG Layer] &lt;--&gt; [OpenAI API]
    </pre>

    <h3>Mermaid Class Diagram</h3>
    <pre>
classDiagram
        class User {
                +Interacts via SPA
        }
        class Frontend {
                +HTML/JavaScript SPA
                +CRUD TurboCASH Books
                +OpenAI Integration
        }
        class TurboCASHServer {
                +RESTful API
                +Validation, Logging
                +Authentication
        }
        class Database {
                +Firebird SQL
                +Persistent Storage
        }
        class ETL_RAG {
                +Extract/Transform/Load
                +Data Cleansing
                +RAG Orchestration
        }
        class OpenAIAPI {
                +AI-powered Features
                +Natural Language Queries
        }

        User --> Frontend
        Frontend --> TurboCASHServer
        TurboCASHServer --> Database
        TurboCASHServer --> ETL_RAG
        ETL_RAG --> Database
        ETL_RAG --> OpenAIAPI
        Frontend --> OpenAIAPI
    </pre>

    <section>
        <h2>Frequently Asked Questions (AI Search)</h2>
        <style>
            details { margin-bottom: 1em; }
            summary { cursor: pointer; font-weight: bold; color: #1a4b7a; }
        </style>
        <details>
            <summary>1. How does TurboCASH 6 integrate AI features into accounting workflows?</summary>
            <div>
                TurboCASH 6 uses an ETL and RAG orchestration layer to extract and transform accounting data into token-friendly JSON structures. These are then used by OpenAI-powered modules for natural language queries, insights, and automation directly within the HTML/JavaScript frontend.
            </div>
        </details>
        <details>
            <summary>2. Can TurboCASH 6 operate with both SQL and NoSQL databases?</summary>
            <div>
                Yes. The primary data is stored in Firebird SQL for persistence, while extracted and transformed data for AI workflows can be stored in a NoSQL database (e.g., MongoDB). The system architecture supports interchangeable NoSQL backends via an abstracted data access layer.
            </div>
        </details>
        <details>
            <summary>3. How does TurboCASH 6 ensure interoperability with TurboCASH 5?</summary>
            <div>
                TurboCASH 6 communicates with TurboCASH 5 using its open API, enabling data synchronization and CRUD operations. The ETL layer can archive or retrieve data from TurboCASH 5, ensuring compatibility and seamless integration.
            </div>
        </details>
        <details>
            <summary>4. What security measures are in place for AI and data access?</summary>
            <div>
                The system uses HTTPS for secure communication, JWT-based authentication, and user authorization. API endpoints are protected, and data access is managed via secure connectors and middleware for validation and logging.
            </div>
        </details>
        <details>
            <summary>5. How does the frontend leverage OpenAI for user queries?</summary>
            <div>
                The HTML/JavaScript SPA integrates with the OpenAI API, allowing users to perform natural language queries and receive AI-driven insights. The frontend communicates with the server and AI modules to provide real-time, context-aware responses.
            </div>
        </details>
    </section>

    <footer>
        <hr>
        <p><small>TurboCASH 6 System Architecture &copy; 2025. MIT Open Source. For more information, visit <a href="https://turbocash.net/">TurboCASH</a>.</small></p>
    </footer>
</body>
</html>

##### Markdown

Preamble

The aim of TurboCASH 6 is to write an AI-facing accounting package using JavaScript on front and back ends.

The package is written under an open source license.

The package must be self-standing and interoperable with TurboCASH 5 (a proprietary closed Delphi system), that has open source components and an open API to interact.

Define a system architecture that has "TurboCASH Server running on a Windows 10 or 11 PC, Windows 11 Pro not required, Linux would be nice.

Single language JavaScript

Such a system must be able to CRUD a record into a TurboCASH Books

There must be an HTML JavaScript front end and that must be OpenAI compatible, so that AI is written core into the system

With the new information, please renumber the section 1 to 5 - expand to as many sections as you need.

The aim of TurboCASH 6 is to write a AI facing accounting package  using Javascript on front and back ends.

### Questions & Answers

#### Q1: Can this be stored in a NoSQL database? Data can be archived into TurboCASH 5 and queried using a REST API.

**A:**  
Yes, the extracted and transformed data can be stored in a NoSQL database. This approach is suitable for AI workflows, as document-oriented databases (like MongoDB) handle flexible, JSON-like structures that are easily tokenized for AI models. Data can be archived or synchronized with TurboCASH 5 via its open API, enabling interoperability and REST-based queries.

#### Q2: Would Mongo be a good NoSQL database?

**A:**  
MongoDB is a strong choice for this use case. It is widely adopted, supports JSON documents natively, scales well, and integrates easily with JavaScript-based stacks. Its flexible schema is ideal for evolving accounting data and AI-driven requirements.

#### Q3: Would it be possible to make the NoSQL database interchangeable?

**A:**  
Yes, by abstracting the data access layer and using standard interfaces (e.g., via an ORM or repository pattern), the system can support interchangeable NoSQL databases. This allows switching between MongoDB, CouchDB, or other document stores with minimal changes to application logic.

## Renumbered & Expanded System Architecture

### 1. Overview
- TurboCASH Server operates on Windows 10 or 11 (Pro not required).
- System enables CRUD operations on TurboCASH Books.
- HTML/JavaScript frontend with OpenAI integration for AI-powered features.

### 2. Server Layer
- TurboCASH Server exposes RESTful API for CRUD operations.
- Middleware handles validation, logging, error management.
- API endpoints secured with authentication (e.g., JWT).
- Supports concurrent client connections.
- API documentation available for integration.

### 3. Database Layer
- TurboCASH Books stored in Firebird SQL database.
- Direct connectivity for persistent storage and retrieval.
- Database access managed via secure connectors.

Are we missing teh structure of the extrated Data base - some king of NoSQL strusutre that is eas easilty ocovnerted to tokens? Pleas eexpmand

### 3.1. Extracted Data Structure for AI Workflows

- **Purpose:** To facilitate AI-powered features (e.g., RAG, natural language queries), data extracted from the Firebird SQL database should be transformed into a flexible, token-friendly format.
- **NoSQL Representation:** After ETL, records are mapped to a document-oriented NoSQL structure (e.g., JSON objects), which is easily convertible to tokens for AI models.
- **Example Structure:**
    ```json
    {
      "book_id": "12345",
      "customer": {
        "name": "Acme Corp",
        "address": "123 Main St",
        "contacts": ["info@acme.com"]
      },
      "transactions": [
        {
          "date": "2024-06-01",
          "amount": 1000,
          "type": "invoice"
        }
      ],
      "metadata": {
        "last_modified": "2024-06-10T12:00:00Z"
      }
    }
    ```
- **Advantages:**
    - **Tokenization:** JSON-like structures are natively supported by most AI tokenizers.
    - **Flexibility:** Easily accommodates new fields or changes in schema.
    - **Interoperability:** Can be indexed, searched, and retrieved efficiently for RAG and other AI workflows.
- **Conversion Process:**
    - ETL layer extracts relational data.
    - Transforms records into NoSQL (JSON) documents.
    - Stores in a transient NoSQL store or passes directly to AI modules.

- **Integration:** This structure is used by the RAG orchestration layer to provide relevant context to OpenAI-powered features, ensuring efficient and accurate tokenization for model input.

### 4. ETL & RAG Orchestration Layer
- ETL service extracts, transforms, and loads data from Firebird SQL.
- Data cleansing, normalization, and enrichment for AI consumption.
- RAG orchestration uses ETL output to provide context for AI workflows.
- Integrates with model context protocol for Retrieval-Augmented Generation.

### 5. Frontend Layer
- HTML/JavaScript SPA communicates with TurboCASH Server API.
- Provides CRUD interface for TurboCASH Books.
- Responsive design for desktop and mobile devices.

### 6. AI Integration Layer
- OpenAI API integrated into frontend for natural language queries and data analysis.
- AI logic embedded in system for enhanced user interaction with accounting data.

### 7. Data Flow
- User interacts with frontend.
- Frontend sends CRUD requests to TurboCASH Server API.
- AI features leverage OpenAI API for insights and automation.
- ETL/RAG layers ensure relevant, up-to-date data for AI.

### 8. Security & Deployment
- HTTPS for secure communication.
- User authentication and authorization.
- Deployable on standard Windows 10/11 hardware.

### 9. Integration Points
- ETL interfaces with Firebird SQL database.
- RAG orchestration bridges ETL and OpenAI API.
- Frontend, server, and AI layers communicate via documented APIs.

**Diagram (Textual):**

[User] <--HTML/JS SPA--> [TurboCASH Server API] <---> [TurboCASH Database]
              |
              v
        [ETL & RAG Layer] <--> [OpenAI API]

        ```mermaid
        classDiagram
            class User {
                +Interacts via SPA
            }
            class Frontend {
                +HTML/JavaScript SPA
                +CRUD TurboCASH Books
                +OpenAI Integration
            }
            class TurboCASHServer {
                +RESTful API
                +Validation, Logging
                +Authentication
            }
            class Database {
                +Firebird SQL
                +Persistent Storage
            }
            class ETL_RAG {
                +Extract/Transform/Load
                +Data Cleansing
                +RAG Orchestration
            }
            class OpenAIAPI {
                +AI-powered Features
                +Natural Language Queries
            }

            User --> Frontend
            Frontend --> TurboCASHServer
            TurboCASHServer --> Database
            TurboCASHServer --> ETL_RAG
            ETL_RAG --> Database
            ETL_RAG --> OpenAIAPI
            Frontend --> OpenAIAPI
        ```


